<!DOCTYPE html>
<html>
<head>
	<title>Leave Management System</title>
		<!-- Latest compiled and minified CSS -->
		<script src="js/checkStaffSignIn.js" type="text/javascript"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/datatables.css">

			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
			<script src="js/checkAvailableRequest.js" type="text/javascript"></script>

		<!-- Popper JS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

      
        <script src="js/forms.js" type="text/javascript"></script>
     
		  


		


</head>
<body>
			
				<nav class="navbar navbar-expand-lg navbar-light  bg-primary">
					<div class="container">
						<a class="navbar-brand text-white" style="font-size: 25px;" href="#"><strong>Decagon Leave Management System</strong></a>
						<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
						</button>

						<div class="collapse navbar-collapse " id="navbarSupportedContent">
						<ul class="navbar-nav mr-auto text-white">
						&nbsp;&nbsp;
						<li class="nav-item active">
						<a class="nav-link text-white" href="index.html">Main Page <span class="sr-only">(current)</span> |</a>
						</li>
					
						
						
						 <li class="nav-item">
						<a class="nav-link text-white update_leave_request" onclick='updateLeave(email)' id="update_leave_request" href="#">Update Leave Request |</a> 
						</li> 

						<li class="nav-item">
						<a class="nav-link text-white delete_leave_request" onclick='deleteLeave(email)' id="delete_leave_request" href="#">Delete Leave Request </a> 
						</li> 
				

						


							<!-- to differentiate admin from user, just add a privilege level status -->
						<li class="nav-item">
						<a class="btn btn-sm btn-danger admin_logout" id="staffLogoutBtn" href="#">Logout</a>
						</li>
					
						</ul>
					
						</div>
					</div>
				</nav>

				<main>

			
				
		


					 <div id="leave_request_div">
					  	
								<br>
								<div align="center"><div id="staff_info"></div>&nbsp;&nbsp;<small class="badge badge-sm badge-primary">You are logged in as a Staff</small></div>

								<h4 align="center">Create a Leave Request </h4>
								<hr>
								<div class="row">
								
								<div class="col-lg-4 col-md-12 col-sm-12"></div>
								

								<div class="col-lg-4 col-md-12 col-sm-12">
									<div align="center" id="staff_notification"></div>
									<br>
								

								<form id="request_form">
								
								<div class="form-group">
								<label>Leave Start Date</label>
								<input type="date" name="start_date" required id="start_date" class="form-control" placeholder="Leave Start Date">
								</div>

								<div class="form-group">
									<label>Leave End Date</label>
									<input type="date" name="end_date" required id="end_date" class="form-control" placeholder="Leave End Date">
								</div>

								
								
								<div class="form-group">

								<label>Purpose of Leave</label>
									<select class="form-control" id="leave_purpose" required="">
										   <option value="">Choose a Leave</option>
											<option value="Maternity Leave">Maternity Leave</option>
											<option value="Paternity Leave">Paternity Leave</option>
											<option value="Bereavement Leave">Bereavement Leave</option>
											<option value="Sick Leave">Sick Leave</option>
											<option value="Administrative Leave">Administrative leave</option>
											<option value="Adoption leave">Adoption leave</option>
											<option value="Annual Leave">Annual Leave</option>
											<option value="Nursing Leave">Nursing Leave</option>
											<option value="Study Leave">Study Leave</option>
											<option value="Casual Leave">Casual Leave</option>
											<option value="Vacation Leave">Vacation Leave</option>
											<option value="Others">Others</option>
										
									</select>
								</div>



								<div class="form-group">

								<label>Leave Description</label>
								<textarea type="" class="form-control" name="leave_detail" id="leave_detail">
									
								</textarea>

								</div>


								</div>

						


								<div class="col-lg-4 col-md-12 col-sm-12"></div>


								</div>

								<div class="row">
								<div class="col-lg-4 col-md-12 col-sm-12"></div>
								<div class="col-lg-4 col-md-12 col-sm-12"><button id="leaveRequestBtn" class="btn btn-md btn-primary btn-block">Send Leave Request</button></div>
								<div class="col-lg-4 col-md-12 col-sm-12"></div>
								</div>

								</form>

					  </div>



					   <div id="leave_status_div">
					  	
								<br>
								<div align="center"><div id="staff_info"></div>&nbsp;&nbsp;<small class="badge badge-sm badge-primary">You are logged in as a Staff</small></div>

								<h4 align="center">Your Request Has Been Sent <div id="display"></div></h4>
								<hr>
							

								

					  </div>

					  <div id="show_update_request_div"></div>
 

 





				</main>

<!-- jQuery library -->
	
      
      <script type="text/javascript">
			//update leave request
			 ///////approve a leave requests
           function updateLeave(email){
        			//alert(email);
        			let output = "";
			        	$.ajax({
			        		method: 'GET',
			        		url: `http://localhost:3000/leave_requests?email=${email}`,
			        		data: {
			        			email
			        		},
			        	    success:function(resp){
                               if(resp.length){
                               	   const start_date = resp[0].start_date;
                               	   const email = resp[0].email;
                               	   const staffFirstName = resp[0].staffFirstName;
                               	   const staffLastName = resp[0].staffLastName;
                               	    const staffPhoneno = resp[0].staffPhoneno;
                               	   const end_date = resp[0].end_date;
                               	   const leave_purpose = resp[0].leave_purpose;
                               	   const leave_detail = resp[0].leave_detail;
                               	   const id = resp[0].id;
                               	

                               		output +='<h4 align="center">Update Leave Request </h4>';
                               		output +='<div class="row"><div class="col-lg-4 col-md-12 col-sm-12"></div><div class="col-lg-4 col-md-12 col-sm-12"><div align="center" id="staff_notificationn"></div><br>'; 
                               		output +='<form id="request_form"><div class="form-group"><label>Leave Start Date</label><input type="date" name="start_date_update" required id="start_date_update" class="form-control" value='+start_date+' placeholder="Leave Start Date"></div><div class="form-group"><label>Leave End Date</label><input type="date" name="end_date_update" value='+end_date+' required id="end_date_update" class="form-control" placeholder="Leave End Date"></div><div class="form-group"><label>Purpose of Leave</label><select class="form-control" id="leave_purpose_update" required=""><option value="'+leave_purpose+'">'+leave_purpose+'</option><option value="Maternity Leave">Maternity Leave</option><option value="Paternity Leave">Paternity Leave</option><option value="Bereavement Leave">Bereavement Leave</option><option value="Sick Leave">Sick Leave</option><option value="Administrative Leave">Administrative leave</option><option value="Adoption leave">Adoption leave</option><option value="Annual Leave">Annual Leave</option><option value="Nursing Leave">Nursing Leave</option><option value="Study Leave">Study Leave</option><option value="Casual Leave">Casual Leave</option><option value="Vacation Leave">Vacation Leave</option><option value="Others">Others</option></select></div><div class="form-group"><label>Leave Description</label><textarea type="" class="form-control" name="leave_detail" id="leave_detail_update">'+leave_detail+'</textarea></div></div><div class="col-lg-4 col-md-12 col-sm-12"></div></div><div class="row"><div class="col-lg-4 col-md-12 col-sm-12"></div><div class="col-lg-4 col-md-12 col-sm-12"><button id="updateleaveRequestBtn" onclick="updateRequest('+id+')" class="btn btn-md btn-primary btn-block">Update Request</button></div><div class="col-lg-4 col-md-12 col-sm-12"></div></div>';
                               		
                               	}

                               	$('#leave_request_div').hide();
                               	$('#show_update_request_div').html(output);
               
			        	    }
			        	});
			      }




           function deleteLeave(email){
        			//alert(email);
        			let output = "";
			        	$.ajax({
			        		method: 'GET',
			        		url: `http://localhost:3000/leave_requests?email=${email}`,
			        		data: {
			        			email
			        		},
			        	    success:function(resp){
                               if(resp.length){
                               	   const start_date = resp[0].start_date;
                               	   const email = resp[0].email;
                               	   const staffFirstName = resp[0].staffFirstName;
                               	   const staffLastName = resp[0].staffLastName;
                               	    const staffPhoneno = resp[0].staffPhoneno;
                               	   const end_date = resp[0].end_date;
                               	   const leave_purpose = resp[0].leave_purpose;
                               	   const leave_detail = resp[0].leave_detail;
                               	   const id = resp[0].id;
                               	

                               		output +='<h4 align="center">Delete Leave Request<br><span style="color:red;font-size:15px;">Please note that once the delete button is clicked, your request is erased from the HR Database<span> </h4>';
                               		output +='<div class="row"><div class="col-lg-4 col-md-12 col-sm-12"></div><div class="col-lg-4 col-md-12 col-sm-12"><div align="center" id="staff_notificationn"></div><br>'; 
                               		output +='<form id="request_form"><div class="form-group"><label>Leave Start Date</label><input type="date" name="start_date_update" required id="start_date_update" class="form-control" value='+start_date+' placeholder="Leave Start Date"></div><div class="form-group"><label>Leave End Date</label><input type="date" name="end_date_update" value='+end_date+' required id="end_date_update" class="form-control" placeholder="Leave End Date"></div><div class="form-group"><label>Purpose of Leave</label><select class="form-control" id="leave_purpose_update" required=""><option value="'+leave_purpose+'">'+leave_purpose+'</option><option value="Maternity Leave">Maternity Leave</option><option value="Paternity Leave">Paternity Leave</option><option value="Bereavement Leave">Bereavement Leave</option><option value="Sick Leave">Sick Leave</option><option value="Administrative Leave">Administrative leave</option><option value="Adoption leave">Adoption leave</option><option value="Annual Leave">Annual Leave</option><option value="Nursing Leave">Nursing Leave</option><option value="Study Leave">Study Leave</option><option value="Casual Leave">Casual Leave</option><option value="Vacation Leave">Vacation Leave</option><option value="Others">Others</option></select></div><div class="form-group"><label>Leave Description</label><textarea type="" class="form-control" name="leave_detail" id="leave_detail_update">'+leave_detail+'</textarea></div></div><div class="col-lg-4 col-md-12 col-sm-12"></div></div><div class="row"><div class="col-lg-4 col-md-12 col-sm-12"></div><div class="col-lg-4 col-md-12 col-sm-12"><button id="updateleaveRequestBtn" onclick="deleteRequest('+id+')" class="btn btn-md btn-danger btn-block">Delete Request</button></div><div class="col-lg-4 col-md-12 col-sm-12"></div></div>';
                               		
                               	}

                               	$('#leave_request_div').hide();
                               	$('#show_update_request_div').html(output);
               
			        	    }
			        	});
			      }



			function deleteRequest(id){
					
				$.ajax({
			        		method: 'DELETE',
			        		url: `http://localhost:3000/leave_requests/${id}`,
			        		data: {
			        		},
			        	    success:function(del_response){
                               
                               		//alert('success');
                               		 $('#staff_notificationn').html('<span class="badge badge-danger">Deletion  of your leave request was successful &nbsp;&nbsp;<a href="staffHome.html" class="text-white">Return to Dashboard</a></span>');
     
                              
                            }

			        	});
			}


			function updateRequest(id){
					start_date_update = $('#start_date_update').val();
					end_date_update = $('#end_date_update').val();
					leave_purpose_update = $('#leave_purpose_update').val();
					leave_detail_update = $('#leave_detail_update').val();
			        	
				$.ajax({
			        		method: 'PATCH',
			        		url: `http://localhost:3000/leave_requests/${id}`,
			        		data: {
			        			start_date: start_date_update,
			        			end_date: end_date_update,
			        			leave_purpose: leave_purpose_update,
			        			leave_detail: leave_detail_update
			        		},
			        	    success:function(update_response){
                               
                               		//alert('success');
                               		 $('#staff_notificationn').html('<span class="badge badge-success">Update of your leave request was successful &nbsp;&nbsp;<a href="staffHome.html" class="text-white">Return to Dashboard</a></span>');
     
                              
                            }

			        	});
			}
			     
			     
	


			


      </script>   
   
        
       
</body>

</html>